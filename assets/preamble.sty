\NeedsTeXFormat{LaTeX2e}[1994/06/01]
\ProvidesPackage{preamble}[2018/12/08 Document Preamble]

% Acronyms
\RequirePackage[acronym, shortcuts, nopostdot]{glossaries}
\input{acronyms}

% Bibliography
\RequirePackage[square,numbers,sort]{natbib}
\RequirePackage{usebib}
\bibliographystyle{ieeetr}
\bibinput{references}

% Font
\def\fontscale{0.85}
\RequirePackage[no-math]{fontspec}
\setmainfont{Ubuntu Light}[Scale=\fontscale]
\setsansfont{Ubuntu Light}[Scale=\fontscale]
\setmonofont{Ubuntu Mono}[Scale=\fontscale]
\RequirePackage{xeCJK}
\setCJKmainfont{Noto Sans SC}[Scale=\fontscale]
\setCJKsansfont{Noto Sans SC}[Scale=\fontscale]
\setCJKmonofont{Noto Sans SC}[Scale=\fontscale]

% Hyperlinks
\RequirePackage{hyperref}
\hypersetup{colorlinks=true,anchorcolor=black,linkcolor=\primarycolor,citecolor=\primarycolor,urlcolor=\primarycolor}

% Tables
\RequirePackage{tabularray}

% Captions
\setlength{\abovecaptionskip}{0em}
\setlength{\belowcaptionskip}{0em}

% Units
\RequirePackage{eurosym}
\RequirePackage{siunitx}
\DeclareSIUnit{\sieuro}{\mbox{\euro}}
\sisetup{range-units=single,range-phrase=--}

% Listings
\RequirePackage{minted}
\usemintedstyle{fhtw}

% Custom
\NewDocumentCommand{\res}{ m }{``\textbf{\usebibentry{#1}{title}}'', \usebibentry{#1}{url} \cite{#1}}
\NewDocumentCommand{\key}{ O{} O{} m }{\tikz[baseline=(key.base),#1]\node[fill=tw-gray!20!white,draw,shape=rectangle,inner sep=0.25em,rounded corners=0.125em,drop shadow={shadow xshift=0.125em,shadow yshift=-0.125em,color=tw-gray},#2](key){#3};}
\setlength{\parskip}{1em}

% Circuits
\input{figures/rp2040}
\input{figures/resistor}

\newcommand{\iarronly}[1]{% name
    \node [currarrow, color=red, anchor=center,rotate=\ctikzgetdirection{#1-Iarrow}] at (#1-Ipos) {};
}
\newcommand{\varronly}[1]{% name
    \draw [color=blue] (#1-Vfrom) .. controls (#1-Vcont1) and (#1-Vcont2).. (#1-Vto) node [currarrow, sloped, anchor=tip, allow upside down,pos=1]{};
}
\NewDocumentCommand{\fixedvlen}{O{0.5cm} m m O{}}{% [semilength]{node}{label}[extra options]
    % get the center of the standard arrow
    \coordinate (#2-Vcenter) at ($(#2-Vfrom)!0.5!(#2-Vto)$);
    % draw an arrow of a fixed size around that center and on the same line
    \draw[-Triangle, #4] ($(#2-Vcenter)!#1!(#2-Vfrom)$) -- ($(#2-Vcenter)!#1!(#2-Vto)$);
    % position the label as in the normal voltages
    \node[anchor=\ctikzgetanchor{#2}{Vlab}, #4] at ($(#2-Vlab) + (0.35,0)$) {#3};
}